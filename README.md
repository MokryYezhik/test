# test


# Рекомендательная система текстовых постов

Данный проект представляет собой сервис, который для имеющихся пользователей возвращает посты, которые должны ему понравится.

**Изначальные данные**:
- таблица с информацией о пользователях 
  (возраст, пол, город, страна, ОС устройства, откуда пользователь пришел(реклама или нет))
- таблица с постами
  (тема поста и его текст)
- таблица с информацией об активности пользователя
  (просмотры и лайки пользователями постов)

**Стэк**:
- Python
- Pandas
- FastApi
- Psycopg2
- Pydantic
- Pytorch
- Sklearn

-----

## Запуск сервиса

Клонирование репозитория:
`git clone git@github.com:MokryYezhik/kc.git`

Запуск сервиса:
`cd final_project`
`python -m uvicorn app:app`

Пример запроса:
`/post/recommendations/?id=200&time=2021-12-10T00:00:00&limit=10`

------

## Модель

Список постов формируется моделью, обученной на имеющейся инвормации о взаимодействии пользователей с постами, а также признаках самих постов и пользователей. Модель предсказыает вероятность, что пост может понравиться пользователю.

В качестве модели используется полносвязная NN, которая объединяет контентный и коллаборативный подходы к построению рекомендательных систем.

<p>Признаки пользователей представлены в модели как их данные без изменений.</p>
Признаки по текстам постов извлекались следующим образом: векторизация с помощью TF-IDF, разделение на основе этого веторного представления на кластеры с KMeans, получение непостредственно самих признаков как расстояние до центра кластеров.
За коллаборатвный подход отвечают два обучаемых слоя эмбеддингов для пользователей и для постов соответственно.
<p>На вход модели подается конкатенация веторов эмбэддингов и признаков пользователей и постов.</p>

### Метрика

$Hitrate@5$ равняется 1, если из 5-ти рекомендованныых постов пользователю понравился >= 1 постов, иначе равно 0.

$$Hitrate@5 = frac{1}{nT}\sum{t=1}{T}\sum{n}{i=1}min(1, \sum{j=1}{5}[a_j(x, t)=1])$$

где:
- $n$ - количество пользователей
- $T$ - количество периодов проверки
- $a_j(x,t)$ - $j$-ая рекомендация $i$-ому пользователю в момент времени t

**Результат**: hitrate@5 = 0.56

---



